#  												[大合奏!! Ex]使用教程 Ver2.8版

![1570334206913](http://static.it99.com.cn/2019/10/1570334206913.png)

-----


## 0. 免责声明

![1570334064740](http://static.it99.com.cn/2019/10/1570334064740.png)



> 本软件的基本功能完全免费且开源发布，部分功能定制开发唯一联系方式为QQ：shiro@ffxiv.cat
>
> 从2.8.* 版本开始，【大合奏!】 更名为 【大合奏! Ex 】, 针对合奏、解析等进行了多处优化 

你可以在这里下载到一份淘宝售卖的乐谱包作为开始：[蓝奏云](https://wwvi.lanzoub.com/ivUNC0hlkaba)

​			

## 1. 快速上手

​	**第一次使用时请务必进行键位设置。**

​							![image-20221202230729644](http://static.it99.com.cn//uPic/2022/12/02/230729-image-20221202230729644-2ce38a9b4d15.png)		 

1. 点击设置页面，点击演奏键位设置，在弹出的窗口中，与游戏按键设置一致后，点击确定即可保存。

   电吉他切换按键可以不设定。并不影响实际演奏。

   ![image-20221202231056915](http://static.it99.com.cn//uPic/2022/12/02/231057-image-20221202231056915-68cbf05d4acf.png)

2. 在已经开启FF14游戏的前提下，在设置界面点击【打开后台演奏】，即可自动绑定

   ![image-20221202231448252](http://static.it99.com.cn//uPic/2022/12/02/231448-image-20221202231448252-eeadabfd78e7.png)

3. 点击独奏界面，打开Midi文件，选择轨道

   ![image-20221202231502357](http://static.it99.com.cn//uPic/2022/12/02/231502-image-20221202231502357-ee6992da3760.png)

4. 选择完毕后，按下默认快捷键[CTRL+F10]，或点击独奏界面上的播放按钮，即可开始演奏。

5. 演奏中可以实时通过快捷键或界面按钮进行暂停、播放、停止、快进（每次50ms）、快退（50ms）、调整速度、调整音高等操作

6. 恭喜你，已经完成了自动演奏的基本功能。如果你对如何合奏、如何使用Midi键盘演奏感兴趣，可以继续往下浏览。



##  2. 合奏

>  无论使用哪种方式进行演奏，都需要先在[独奏]界面中导入Midi和选择轨道。合奏过程中也可以使用[独奏界面]中的按钮进行播放控制
>
>  建议在设置中打开[PCAP解析]， [点这里](https://www.winpcap.org/)下载驱动
>
>  视频教程：

### 2.1 网络合奏模式

1. 网络合奏默认关闭，需要先选择【小队倒计时】演奏或是【合奏助手】演奏后，才可激活。

2. 激活时如果已经绑定后台演奏，可以自动绑定到对应的游戏进程。

3. 网络合奏模式打开时，同时还会捕捉到玩家切换乐器的事件，并将当前乐器展示在标题栏。

   > 与此同时，导入midi后会根据轨道名称自动匹配对应乐器。即 你当前乐器为鲁特琴，则导入midi后悔自动选择名为lute的轨道
   >
   > 你可以在 [这个腾讯文档](https://docs.qq.com/sheet/DTlhJcVBEckplZGRr?tab=BB08J2) 找到哪些轨道名会自动被匹配， 你也可以留下编辑记录，在适当的时间会更新到主版本中。

   #### 2.1.1 小队倒计时模式

   ​	· 所有合奏成员需在同一个小队中。

   ​	· 任意队员发起小队战斗倒计时，倒计时时间归零后即开始演奏。	![image-20221202232653191](http://static.it99.com.cn//uPic/2022/12/02/232653-image-20221202232653191-6073931109e8.png)

   ![image-20221202232639404](http://static.it99.com.cn//uPic/2022/12/02/232639-image-20221202232639404-57206abc4855.png)

   · 任意队员进行【地面标记】操作，即可停止小队内所有人的演奏

   #### 2.1.2合奏助手模式

   · 所有合奏成员需在同一个小队中。

   · 所有合奏成员已经进入演奏界面。

   · 队长点击【合奏准备确认】，其余参数无需设定。![image-20221202234106508](http://static.it99.com.cn//uPic/2022/12/02/234106-image-20221202234106508-7e20f012ddd5.png)
   
   · 当所有人点击准备后，3秒后即可开始演奏。
   
   · 演奏中，任意成员在游戏中的合奏助手点击停止合奏，即可停止所有人演奏。
   
    **重要提示**：游戏设定合奏助手从按键到听到声音的延迟为3秒。无法更改，如果合奏中有人存在延迟，可以通过[独奏]选项卡的快进快退进行设置以调整。

### 2.2 经典合奏模式

​		该合奏模式可以不需要组队

​	· 合奏的所有成员需要点击定时演奏的时间选择框，选择同一个时间，点击定时

​	· 提示X秒后开始演奏即可等待。此时切换到[独奏]选项卡可以进行播放控制。 

![image-20221202235224335](http://static.it99.com.cn//uPic/2022/12/02/235224-image-20221202235224335-4e9bb632342c.png)

### 2.3 双开合奏示例

视频教程：

1. 在同一台机器打开两个FF14游戏
2. 打开两个大合奏!!Ex的程序，第二个程序打开时会提示快捷键注册失败，无需理会。
3. 分别在两个大合奏!!Ex的[设置]选项卡，打开后台演奏，根据提示绑定到不同的FF14进程上。
4. 分别在两个大合奏!!Ex的[合奏]选项卡，选择合奏方式，打开网络合奏。
5. 根据合奏方式，点击小队倒计时或合奏助手，自动等待即可开始合奏。




## 3. Midi键盘演奏

​	![1570337330274](http://static.it99.com.cn/2019/10/1570337330274.png)

### 1. 快速链接

1. 将midi设备通过usb连接到电脑上，在[外接]选项卡中选择Midi设备下拉菜单找到自己的设备

2. 点击开始连接，当提示连接成功后即可在游戏中使用midi键盘进行演奏。


​	![1570337599657](http://static.it99.com.cn/2019/10/1570337599657.png)



### 2. 音域调整

​	我的Midi键盘/电钢的中央C跟游戏差了一个八度/若干八度，怎么办？

1. 连接Midi键盘
1. 按下你想使用音域的最低音（例：对于88键电钢，想使用C1~C4进行游戏演奏，那请按下C1）
1. 在[外接]选项卡的按键测试栏，原始Key为你按键的原始信息，解析后Key为程序转换到游戏的Key，解析后的范围应在48~84之间。
1. 调整滑动条，使你当前按下的最低音，在解析后的Key=48.即可完成设定



### 3. 键盘链接功能：Midi键盘一控二/一控多/实时音效反馈

> 该功能可以将电钢的输入转发到多个虚拟设备中，如图所示
>
> ![image-20221203002743608](http://static.it99.com.cn//uPic/2022/12/03/002743-image-20221203002743608-89268255f68e.png)
>
> 因相关SDK需要授权，因此该功能无法集成到软件中，需借助第三方工具LoopMidi
>
> Loopmidi的下载地址为 https://www.tobias-erichsen.de/software/loopmidi.html

1. 打开Loopmidi,创建虚拟midi设备，建议至少创建2个。

![image-20221203002452328](http://static.it99.com.cn//uPic/2022/12/03/002452-image-20221203002452328-7dc6781e661d.png)

2. 切换到[外接选项卡]，在键盘链接选项中勾选想输出的设备。点击开启。

3. 在上方下拉菜单，连接输入设备。此时Midi键盘的输入将同步转发到勾选的设备。

   #### 一控多

   ​	新开一个大合奏!Ex的程序，在外接中，选择任意转发后的设备，图例为LoopMidi Port，点击链接

   ​	此时可以看到Midi键盘的输入可以在两个程序上同时收到，同理可以实现一控多。配合参数调整可以实现88键电钢双开左右手演奏。

   #### 实时回放

   ​	方法1：链接键盘时，勾选上Microsoft Wavetable. 这是微软自带的Midi播放设备，但由于声卡原因，会有0.5秒左右延迟。

   ​	方法2：开启水果之类的DAW，链接任一LoopMidi port，在声卡中设置为ASIO，即可实现按键的实时回放。

## 4. 试听

试听功能默认为试听【当前选择轨道】的【解析后】的轨道。

如果想当成MIdi播放器使用，需要打开[播放所有轨道]选项；并在设置选项卡中 关闭乐谱解析。

使用此功能时请提前关闭水果等DAW！



## 5. 设置

> 

### 5.1 键位设定

#### 	5.1.1 快捷键绑定

![image-20221203164557896](http://static.it99.com.cn//uPic/2022/12/03/164557-image-20221203164557896-3f3e3013432a.png)

   - 在输入框中直接按下快捷键即可
   - 快捷键可以使用CTRL,ALT,SHIFT
   - 如果快捷键已经被绑定，则输入无效，输入后会自动变为空白
   - 点击输入框右侧的图标可以清空快捷键，未分配的快捷键处于无效状态
   - 向上移调/向下移调一次为1个半音

#### 5.1.2 按键绑定

​	![image-20221203164713389](http://static.it99.com.cn//uPic/2022/12/03/164713-image-20221203164713389-cc288adf450f.png)

- 与游戏中按键设置保持一致即可
- 电吉他的切换按键，仅当打开【电吉他快捷键】时按键有效。需要在Midi制谱时进行特殊设置
- 音高对应： 
- C4=游戏键盘最低音 
- C7=游戏键盘最高音 
- 电吉他：过载=C9 
- 电吉他：清音=C#9 
- 电吉他：闷音=D9 
- 重力和弦= D#9
- 特殊奏法=E9



### 5.2 演奏设定								![image-20221203165237044](http://static.it99.com.cn//uPic/2022/12/03/165237-image-20221203165237044-25a2f4368322.png)

关于解析原理请参照  [6.Midi解析说明](# 6. 针对制谱者- Midi解析说明)

**启用乐谱解析：** 

​		推荐开启，当启用时时，将使用软件内置的解析方法对和弦进行拆分。

​		如果您自己已经拆分过所有和弦或需要做一些极限的演奏谱，仅需要软件进行百分百的还原，可以关闭。

​		关闭后效果等同于使用外接midi播放器通过midiloop链接效果。	

**音符最小间隔：**

​		两个标准midi note间的最小间隔，包括note off到note on，也包括note on 到 note on，设置到50以下意义不大。

​		同时，该间隔也用来作为midi键盘演奏时，音符队列的最小值使用，可以在使用midi键盘时适当减少提升演奏效果。

​		当系统配置较低，游戏帧率较低时可以适当调大该数值。

**和弦最小间隔：**

​		和弦自动分解功能用到的参数，数值越小越接近和弦效果。

​		设置到50以下意义不大，吉他谱等可以适当更改为100左右听感更好。



 ### 5.3 合奏设定

​	**NTP服务器：**

​		用于同步本地时间，如果出现同步失败时可以修改为其他公共ntp服务器。

​		常见公共ntp服务器列表

| **国家授时中心 NTP 服务器** | ntp.ntsc.ac.cn                 |
| :-------------------------- | :----------------------------- |
|           **苹果公司公共 NTP 服务器**              |time.apple.com|
| **腾讯云公共 NTP 服务器**   | time1.cloud.tencent.com（1-5） |
| **国际 NTP 快速授时服务**   | pool.ntp.org                   |

​	**使用winpcap：**

​		软件默认使用winsocket进行网络抓包，您可以[点这里](https://www.winpcap.org/)自行安装npcap驱动后，使用winpcap驱动进行抓包解析。 

### 5.4.LRC歌词播放

> 本功能在设置界面隐藏，只有你知道自己在做什么的时候才推荐打开并设置。
>
> 该功能的游戏表现很可能导致你被封号，请谨慎使用。



0. 在ACT中安装并打开【鲶鱼精邮差】的http监听功能，具体请参照 https://github.com/Natsukage/PostNamazu/wiki/

1. 在[设置选项卡]中，鼠标中键单击某处，显示歌词设置。点击【启用LRC播放】，并设置鲶鱼精邮差的监听端口

2. 设置完毕后，采用任何方式（合奏，定时，快捷键，界面按键）进入演奏时，软件会在midi文件的同路径下寻找同名lrc文件并导入，以开始演奏时间为起点，在lrc设定的时间发送歌词信息。

3. 因歌词的播放与midi的演奏完全绑定，因此也需要一条不为空的轨道。

   推荐做法: 创建一条轨道,分别在首尾放置一个音符.

4. 目前固定为在【说话频道】进行歌词的发送，因为游戏限制高频喊话，请自行调整歌词间隔。

   

## 6. 针对制谱者- Midi解析说明

开启Midi解析后，程序会对导入的Midi文件进行如下处理。

1. **删除掉不含音符的轨道**

2. **清除小于10ms的音符**

   10ms等于750 BPM下的32分音符长度。大多数时间是因编辑时误操作遗留在文件中，因此删除掉。

   对于某些midi和鼓谱轨道，请制谱者手动拉长一些，建议音符时长在25ms（300BPM下的32分音符）以上

3. **将和弦拆分成琶音，拆分逻辑见下图**

   ![image-20221203005329401](http://static.it99.com.cn//uPic/2022/12/03/005329-image-20221203005329401-ec4b7401e726.png)

4. **将连打音符处理成游戏可采集的精度，逻辑见下图。**

   游戏采集时，每秒仅能接收20个事件，每个事件占50ms的格子。

   同音高的按键 需要50ms 按下 + 50ms抬起= 100ms。

   不同音高的按键 只需要50ms 音符A按下 + 50ms音符B按下，游戏会自动抬起取消上一个音的声音输出。

   ![image-20221203005827404](http://static.it99.com.cn//uPic/2022/12/03/005827-image-20221203005827404-6a6dab4bb99b.png)

5. 除此之外并无任何解析动作，如发生演奏与期望不一致时，制谱者可以通过鼠标中键点击[独奏]选项卡的Midi文件名导出解析后的文件自行查看或发送给作者进行分析。





# 附录1：常见问题

### 0.软件启动出错，提示array.empty找不到方法

​	原因：代码使用了.net 4.6以上的特性，因此不支持win7！

​	解决方法：点击微软官方下载链接 https://dotnet.microsoft.com/zh-cn/download/dotnet-framework/net472

### 1.吃音/演奏的与试听不一致

​	**原因1：**由于游戏音域限制，超出C3-C6音域的音无法演奏，表现像为“吃音”，实际上软件并无问题。

​	**对策1：**只要测试谱子没问题那就是没问题，FF专用的谱子请自行制作。



​	**原因2：** 游戏内的两音符的最小时间间隔限制为50ms，如果您的谱子中有**大量和弦**或者**高速演奏**或 出现问题是很正常的现象。

​	**对策2：**建议更换乐谱。

​	

​	**原因3：** 在未开启解析的情况下，Midi文件原始信息中的和弦顺序可能会导致"吃音"的现象。 或开启解析但设置中的最小时间设置过小，演奏时游戏无法及时采集。

​	**对策3：**建议打开乐谱解析功能，适当调大最小事件间隔。





### 2.合奏时不同步

​	**原因：**由于游戏底层系统设计，演奏时的按键会在0.5秒后才会发送到服务器，因此在不使用合奏助手的时候，每个人听到的演奏声音都是比其他人快一些。

![image-20200314141809725](http://static.it99.com.cn/2019/10/image-20200314141809725.png)

​	**对策：** 正常现象，请使用第三人的账号聆听进行判断

​	如果您使用了合奏助手，在合奏中可以自行进行快进和后退来修改延迟。

### 3.多人合奏时长音断掉

​	**原因：**游戏的声音引擎无法同时处理大量的声音片段，因此存在大量的非长音音符（如钢琴、竖琴）时，含有长音的音符（如排箫，萨克斯）会被提前结束播放。

​	**对策：**请入职SE为他们优化 ，招聘链接 https://www.jp.square-enix.com/recruit/career/career/de/game/index.html

### 4.快捷键设置出错

​	**原因：**本软件设置的为全局快捷键，因此您输入的快捷键很可能会与显卡驱动/鼠标键盘驱动/QQ/Reshade/3A画质补丁/吃鸡外挂/一键绝龙诗助手等产生冲突

​	**对策：** 换！个！快！捷！键！

### 5.Midi键盘连接时提示错误

​	如图

![image-20200314141839078](http://static.it99.com.cn/2019/10/image-20200314141839078.png)

​	**原因：** Midi设备已经被其他软件抢占了，包括但不限于水果、蛋糕走、midieditor等一切你按键能出声的软件

​	**对策：**请关掉其他软件重新打开，确保大合奏!Ex 抢占到midi设备。同时使用Midi链接功能，将Midi事件转发到其他软件即可。



### 6.白猫为什么这么可爱

​	![image-20200304233531141](http://static.it99.com.cn/2019/10/image-20200304233531141.png)







# 附录2：更新履历

### 2.8.5.7  (2022/12/3)

被资本家压榨了一年，又备考一年，终于有时间啦

1. 更新：界面和UI库更改，修复高DPI下缩放问题，增加了人性化提示
2. 增加：Midi键盘一控多实例功能
3. 增加：可以在界面上点击按钮进行播放控制（播放，暂停，快进，快退等）
4. 增加：增加若干视频教程，傻肥应该也学得会
5. 更新：网络合奏解析更新
6. 更新：自动升级功能更新
7. 更新：试听功能更新
8. 更新：重写了全部控制逻辑，代码整洁度提高了一点点
9. 移除：网络歌曲导入(beta) 暂时被移除，将在后续平台搭建后重返
10. 移除：悬浮窗功能因过于代码老旧暂时被移除，将在后续重做
11. 移除：mml读取功能暂时被移除，将移动到新的midi处理工具中制作

### 2.7.9.9 (2020/10/15)

1. 增加了轨道固定功能

2. 增加了网络歌曲导入功能（beta）

3. 增加了实时显示当前乐器的功能

4. 优化了和弦解析在多个事件重叠下造成的时间不同步问题

5. 修复了midi键盘连接的显示bug

6. 修复了多个midi键盘重名的连接bug

7. 修复了和弦解析造成的错误bug

8. midi设备输入延迟改为随设置变化

9. 修改了设置界面的选项
   

### 2.6.6.6 (2020/03/15)

1. 增加了歌词输出功能
2. 增加了mml文件的读取（不稳定）
3. 增加了小队倒计时的功能
4. Midi试听功能优化，增加了进度条
5. Midi解析精度提高
6. midi设备输入延迟降低
7. 设置界面变更
8. 原8键/22键模式修改为13键/37键模式
9. 修复了13键（原8键）下按键绑定的bug

### 2.5.2.5 (2019/12/22)

1. 增加了暂停功能及其快捷键
2. 增加了本地双开(β)功能
3. 增加了网络控制(β)功能-使用游戏内指令直接控制每位玩家的演奏
4. 增加了悬浮窗(β)功能
5. 修正了在旧版本Win10下快捷键绑定功能的Bug
6. 修正了演奏结束时会卡键位的问题
7. 修正了设置值的上限

### 2.2.0.0 (2019/10/6)

1. 抓包合奏功能优化
2. midi键盘连接功能优化
3. 增加了读取轨道名的机能
4. 增加了播放时间的显示
5. 增加了后台演奏功能
6. 增加了键位导入导出功能

### 2.1.0.0 (2019/9/30)

1. 优化了和弦处理的逻辑
2. 针对变速曲完善了相应处理
3. 增加了抓包合奏功能
4. 优化了midi键盘按键采集，减少吃音现象
5. 更新服务器转移到中国大陆，避免github被墙

### 2.0.1.9 (2019/04/01)

1. 合奏功能α开放，并且追加了时间同步功能
2. 完全重写了Midi解析部分，演奏会更加流畅
3. 追加了Midi的试听功能
4. 修复了8键下的部分bug
5. 界面微调，预留网络合奏用接口

### 2.0.1.2 (2018/10/22)

1. 修复了BPM过高或过低导致软件崩溃的Bug
2. 修复了读取Midi文件的错误处理，读取到错误的Midi文件时也可以正常处理了
3. 修复了快捷键重复注册时无法退出的Bug
4. 修改了自动更新的一个逻辑

### 2.0.1.1 (2018/10/10)

1. 功能追加
   -和弦分解（beta）
   -自动读取起始BPM并忽略掉Format1的速度轨
   -版本更新检测
2. 逻辑修正
   -修正了演奏算法，现在会更加流畅
   -针对部分错误追加了提示
   -修正了部分Midi文件读取失败的错误
   -修正了部分Midi键盘无法读取NoteOff的问题